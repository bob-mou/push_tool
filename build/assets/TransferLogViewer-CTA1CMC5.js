import{r as i,j as e,d as j,i as T,R as D,D as $,T as C,k as N,l as L,g as k}from"./vendor-react-ti7DexHh.js";function P({onClose:z}){const[l,d]=i.useState([]),[a,x]=i.useState(null),[b,o]=i.useState(!0);i.useEffect(()=>{m()},[]);const m=async()=>{try{const[s,r]=await Promise.all([window.electronAPI.getTransferLog(100),window.electronAPI.getTransferStats()]);d(s),x(r),o(!1)}catch{o(!1)}},v=async()=>{if(confirm("确定要清除所有传输日志吗？此操作不可恢复。"))try{await window.electronAPI.clearTransferLog(),d([]),x(s=>s?{...s,total:0,successful:0,failed:0,byDeviceType:{android:0,ios:0},recent:[]}:null)}catch(s){alert("清除日志失败: "+s)}},y=()=>{const s=l.map(t=>{const w=new Date(t.timestamp).toLocaleString("zh-CN"),S=t.status==="success"?"成功":t.status==="failed"?"失败":"进行中",u=t.fileSize?h(t.fileSize):"",f=t.duration?p(t.duration):"";return[`时间: ${w}`,`设备: ${t.deviceName} (${t.deviceId})`,`类型: ${t.deviceType==="android"?"Android":"iOS"}`,`状态: ${S}`,`源文件: ${t.sourcePath}`,`目标路径: ${t.targetPath}`,u?`文件大小: ${u}`:"",f?`传输时间: ${f}`:"",t.error?`错误信息: ${t.error}`:"","-".repeat(50)].filter(Boolean).join(`
`)}).join(`

`),r=new Blob([s],{type:"text/plain;charset=utf-8"}),n=URL.createObjectURL(r),c=document.createElement("a");c.href=n,c.download=`传输日志_${new Date().toISOString().slice(0,10)}.txt`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(n)},h=s=>{if(s===0)return"0 B";const r=1024,n=["B","KB","MB","GB"],c=Math.floor(Math.log(s)/Math.log(r));return parseFloat((s/Math.pow(r,c)).toFixed(2))+" "+n[c]},p=s=>s<1e3?`${s}ms`:s<6e4?`${(s/1e3).toFixed(1)}s`:`${(s/6e4).toFixed(1)}m`,g=s=>new Date(s).toLocaleString("zh-CN");return b?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"正在加载传输日志..."})]}):e.jsxs("div",{className:"p-3 space-y-1 leading-tight",children:[a&&e.jsxs("div",{className:"bg-gray-50 rounded-lg pt-1 pb-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-600 mb-1 flex items-center space-x-1",children:[e.jsx(j,{className:"w-6 h-4"}),e.jsx("span",{children:"传输统计"})]}),e.jsxs("div",{className:"flex flex-row flex-nowrap gap-x-2",children:[e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a.total}),e.jsx("div",{className:"text-sm text-gray-600",children:"总传输"})]}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:a.successful}),e.jsx("div",{className:"text-sm text-gray-600",children:"成功"})]}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:a.failed}),e.jsx("div",{className:"text-sm text-gray-600",children:"失败"})]}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:a.byDeviceType.android+a.byDeviceType.ios}),e.jsx("div",{className:"text-sm text-gray-600",children:"设备数"})]})]}),e.jsxs("div",{className:"mt-1 flex justify-center space-x-2 text-lg gap-x-10",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-4 h-4 bg-green-500 rounded-full"}),e.jsxs("span",{children:["Android: ",a.byDeviceType.android]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded-full"}),e.jsxs("span",{children:["iOS: ",a.byDeviceType.ios]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center space-x-2",children:[e.jsx(T,{className:"w-6 h-4"}),e.jsxs("span",{children:["传输日志 (",l.length,"条)"]})]}),e.jsxs("div",{className:"flex space-x-2 ml-auto",children:[e.jsx("button",{onClick:m,className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-600 flex items-center space-x-1",children:e.jsx(D,{className:"w-4 h-4"})}),e.jsx("button",{onClick:y,className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-600 flex items-center space-x-1",children:e.jsx($,{className:"w-4 h-4"})}),e.jsx("button",{onClick:v,className:"px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-600 flex items-center space-x-1",children:e.jsx(C,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"space-y-2",children:l.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"暂无传输记录"})]}):l.map((s,r)=>e.jsx("div",{className:"bg-white border rounded-lg p-3 shadow-sm",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 space-y-1.5",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[s.status==="success"?e.jsx(L,{className:"w-4 h-4 text-green-500"}):s.status==="failed"?e.jsx(k,{className:"w-4 h-4 text-red-500"}):e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsxs("span",{className:"text-sm font-medium",children:[s.deviceName," (",s.deviceType==="android"?"Android":"iOS",")"]}),e.jsx("span",{className:"text-xs text-gray-500",children:g(s.timestamp)})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1 break-all",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{children:["源地址: ",s.sourcePath]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{children:["目标地址: ",s.targetPath]})]}),s.fileSize&&e.jsxs("div",{className:"text-xs text-gray-500 break-all",children:["大小: ",h(s.fileSize),s.duration&&e.jsxs("span",{className:"ml-2",children:["用时: ",p(s.duration)]})]})]}),s.error&&e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded break-all",children:[e.jsx("strong",{children:"错误:"})," ",s.error]})]})})},r))})]})}export{P as TransferLogViewer};
