const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./TransferProgress-c5ovdtTl.js","./vendor-react-ti7DexHh.js","./SettingsModal-ie0aDqAd.js","./HelpPage-CwgwbX6n.js"])))=>i.map(i=>d[i]);
import{c as R,r as v,j as e,C as _,R as C,u as L,S as O,U as k,a as F}from"./vendor-react-ti7DexHh.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))c(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const h of s.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&c(h)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const $="modulepreload",M=function(t,r){return new URL(t,r).href},D={},E=function(r,o,c){let n=Promise.resolve();if(o&&o.length>0){let h=function(i){return Promise.all(i.map(d=>Promise.resolve(d).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};const g=document.getElementsByTagName("link"),y=document.querySelector("meta[property=csp-nonce]"),x=y?.nonce||y?.getAttribute("nonce");n=h(o.map(i=>{if(i=M(i,c),i in D)return;D[i]=!0;const d=i.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(!!c)for(let l=g.length-1;l>=0;l--){const a=g[l];if(a.href===i&&(!d||a.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${f}`))return;const w=document.createElement("link");if(w.rel=d?"stylesheet":$,d||(w.as="script"),w.crossOrigin="",w.href=i,x&&w.setAttribute("nonce",x),document.head.appendChild(w),d)return new Promise((l,a)=>{w.addEventListener("load",l),w.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${i}`)))})}))}function s(h){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=h,window.dispatchEvent(g),!g.defaultPrevented)throw h}return n.then(h=>{for(const g of h||[])g.status==="rejected"&&s(g.reason);return r().catch(s)})};function B(t,r){let o;try{o=t()}catch{return}return{getItem:n=>{var s;const h=y=>y===null?null:JSON.parse(y,void 0),g=(s=o.getItem(n))!=null?s:null;return g instanceof Promise?g.then(h):h(g)},setItem:(n,s)=>o.setItem(n,JSON.stringify(s,void 0)),removeItem:n=>o.removeItem(n)}}const A=t=>r=>{try{const o=t(r);return o instanceof Promise?o:{then(c){return A(c)(o)},catch(c){return this}}}catch(o){return{then(c){return this},catch(c){return A(c)(o)}}}},z=(t,r)=>(o,c,n)=>{let s={storage:B(()=>localStorage),partialize:l=>l,version:0,merge:(l,a)=>({...a,...l}),...r},h=!1;const g=new Set,y=new Set;let x=s.storage;if(!x)return t((...l)=>{o(...l)},c,n);const i=()=>{const l=s.partialize({...c()});return x.setItem(s.name,{state:l,version:s.version})},d=n.setState;n.setState=(l,a)=>(d(l,a),i());const f=t((...l)=>(o(...l),i()),c,n);n.getInitialState=()=>f;let P;const w=()=>{var l,a;if(!x)return;h=!1,g.forEach(u=>{var S;return u((S=c())!=null?S:f)});const m=((a=s.onRehydrateStorage)==null?void 0:a.call(s,(l=c())!=null?l:f))||void 0;return A(x.getItem.bind(x))(s.name).then(u=>{if(u)if(typeof u.version=="number"&&u.version!==s.version){if(s.migrate){const S=s.migrate(u.state,u.version);return S instanceof Promise?S.then(p=>[!0,p]):[!0,S]}}else return[!1,u.state];return[!1,void 0]}).then(u=>{var S;const[p,b]=u;if(P=s.merge(b,(S=c())!=null?S:f),o(P,!0),p)return i()}).then(()=>{m?.(P,void 0),P=c(),h=!0,y.forEach(u=>u(P))}).catch(u=>{m?.(void 0,u)})};return n.persist={setOptions:l=>{s={...s,...l},l.storage&&(x=l.storage)},clearStorage:()=>{x?.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>w(),hasHydrated:()=>h,onHydrate:l=>(g.add(l),()=>{g.delete(l)}),onFinishHydration:l=>(y.add(l),()=>{y.delete(l)})},s.skipHydration||w(),P||f},H=z,I=R()(H(t=>({devices:[],selectedDevice:null,isTransferring:!1,transferProgress:null,transferQueue:[],settings:{autoStart:!0,notifications:!0,saveDir:"",iosBundleId:"",iosIdbMode:"i4",pollingInterval:5e3,enableADB:!0,enableIOS:!0,maxRetries:3},setDevices:r=>t({devices:r}),setSelectedDevice:r=>t({selectedDevice:r}),setTransferring:r=>t({isTransferring:r}),setTransferProgress:r=>t({transferProgress:r}),enqueueTransfers:r=>t(o=>({transferQueue:[...o.transferQueue||[],...r]})),dequeueTransfer:()=>t(r=>({transferQueue:(r.transferQueue||[]).slice(1)})),updateSettings:r=>t(o=>({settings:{...o.settings,...r}}))}),{name:"file-tool-settings",partialize:t=>({settings:t.settings})}));function U(){const{devices:t,selectedDevice:r,setDevices:o,setSelectedDevice:c}=I(),[n,s]=v.useState(!1),[h,g]=v.useState(!1),y=d=>{if(!d)return"";const f=(d.name??"").trim();if(String(d.type??"").toLowerCase()==="ios")return f.length>16?f.slice(0,16):f;const w=16;return f.length>w?f.slice(0,w):f};v.useEffect(()=>{if(x(),typeof window<"u"&&window.electronAPI){const d=window.electronAPI;try{const f=d.onDeviceStatusChanged(w=>{x()}),P=d.onDeviceMonitorError(w=>{});return()=>{typeof f=="function"&&f(),typeof P=="function"&&P()}}catch{}}},[]);const x=async()=>{g(!0);try{if(typeof window<"u"&&window.electronAPI){const f=await window.electronAPI.getDevices();o(f),!r&&f&&f.length>0&&c(f[0])}else o([])}catch{}finally{g(!1)}},i=d=>{c(d),s(!1)};return e.jsxs("div",{className:"relative flex items-center electron-no-drag",children:[e.jsxs("button",{onClick:()=>s(!n),className:"flex items-center space-x-1 px-2 py-2 bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow",disabled:t.length===0,children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${r?.status==="connected"?"bg-green-500":"bg-gray-400"}`}),e.jsx("span",{className:"text-gray-700",children:r?y(r):"选择设备"}),e.jsx(_,{className:`w-4 h-4 text-gray-500 transition-transform ${n?"rotate-180":""}`})]}),e.jsx("button",{onClick:x,className:"ml-2 p-3 bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow",disabled:h,children:e.jsx(C,{className:`w-4 h-4 text-gray-600 ${h?"animate-spin":""}`})}),n&&e.jsx("div",{className:"absolute space-x-0 top-full mt-2 w-58 bg-white rounded-lg shadow-lg border z-10",children:e.jsx("div",{className:"p-2",children:t.length===0?e.jsx("div",{className:"px-3 py-2 text-gray-500 text-sm",children:"未检测到连接的设备"}):t.map(d=>e.jsxs("button",{onClick:()=>i(d),className:"w-full flex items-center space-x-3 py-2 text-left hover:bg-gray-50 rounded-md transition-colors",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${d.status==="connected"?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:y(d)}),e.jsxs("div",{className:"text-xs text-gray-500 capitalize",children:[d.type," • ",d.status]})]})]},d.id))})})]})}function q({onSelect:t}){const{selectedDevice:r}=I(),[o,c]=v.useState({android:[],ios:[]}),[n,s]=v.useState({}),[h,g]=v.useState("");v.useEffect(()=>{(async()=>{try{const i=await window.electronAPI.getTransferPathOptions(),d=await window.electronAPI.getTransferPaths();c({android:Array.isArray(i?.android)?i.android:[],ios:Array.isArray(i?.ios)?i.ios:[]}),s({android:String(d?.android||""),ios:String(d?.ios||"")})}catch{}})()},[]);const y=r?.type||"android",x=v.useMemo(()=>y==="android"?o.android:o.ios,[y,o]);return v.useEffect(()=>{const i=x[0]?.path;g(i||""),t(i||void 0)},[x]),v.useEffect(()=>{const i=x.find(d=>d.path===h)?.path;t(i||void 0)},[h]),e.jsx("select",{value:h,onChange:i=>g(i.target.value),className:"px-2 py-2 rounded-lg bg-white shadow-lg border border-gray-200 text-sm",disabled:!r,title:"目标目录",children:x.map(i=>e.jsx("option",{value:i.path,children:i.name},`${y}-${i.name}-${i.path}`))})}const Q=v.lazy(()=>E(()=>import("./TransferProgress-c5ovdtTl.js"),__vite__mapDeps([0,1]),import.meta.url).then(t=>({default:t.TransferProgress}))),W=v.lazy(()=>E(()=>import("./SettingsModal-ie0aDqAd.js"),__vite__mapDeps([2,1]),import.meta.url).then(t=>({default:t.SettingsModal})));function J(){const{selectedDevice:t,isTransferring:r,setTransferring:o,setTransferProgress:c,enqueueTransfers:n,dequeueTransfer:s}=I(),[h,g]=v.useState(!1),[y,x]=v.useState(void 0),i=async(a,m)=>{let u=a.path||a.name;const S=p=>{if(!p)return!0;const b=p.replace(/\\/g,"/");return b.startsWith("./")||b.startsWith("../")?!0:/^[a-zA-Z]:\//.test(b)||b.startsWith("//")||b.startsWith("/")?!1:!p.includes(":")&&!p.includes("\\")};if(!u||u===a.name||S(u))try{const p=new Uint8Array(await a.arrayBuffer()),b=await window.electronAPI.materializeFile({fileName:a.name,data:p});if(b)u=b;else{const j=await window.electronAPI.selectFile();if(!j){alert("请选择文件");return}u=j}}catch{const p=await window.electronAPI.selectFile();if(!p){alert("请选择文件");return}u=p}if(!u||typeof u!="string"){alert("无效的文件路径");return}try{u=decodeURIComponent(u)}catch{}if(u.includes("�")||u.includes("?")||/[\uFFFD-\uFFFF]/.test(u)){alert("文件路径编码错误，请使用文件选择对话框选择文件");return}o(!0),c({fileName:a.name,progress:0,status:"uploading"});try{let p;try{const j=y;if(typeof j=="string"&&j.trim()&&(await window.electronAPI.validateTransferPath({path:j,deviceType:t.type})).valid&&(p=j),!p){const T=await window.electronAPI.getTransferPaths(),N=t.type==="android"?T.android:T.ios;typeof N=="string"&&N.trim()&&(await window.electronAPI.validateTransferPath({path:N,deviceType:t.type})).valid&&(p=N)}}catch{}const b=await window.electronAPI.pushFile({deviceId:t.id,filePath:u,deviceType:t.type,targetDir:p});if(b.success){try{(await window.electronAPI.saveLocalFile({sourcePath:u,options:{preserveAttributes:!0,atomicMove:!0,conflictStrategy:"rename"}}))?.success}catch{}c({fileName:a.name,progress:100,status:"completed",targetPath:b.targetPath}),setTimeout(()=>{c(null),o(!1)},5e3)}else c({fileName:a.name,progress:0,status:"error",error:b.error}),setTimeout(()=>{c(null),o(!1)},3e3)}catch(p){c({fileName:a.name,progress:0,status:"error",error:p.message}),setTimeout(()=>{c(null),o(!1)},3e3)}finally{s();const p=m.shift();p&&await i(p,m)}},d=v.useCallback(async a=>{const m=[...a];m.length>0&&await i(m.shift(),m)},[t]),f=v.useCallback(async a=>{if(!t){alert("请先选择设备");return}if(a.length!==0){for(const m of a)if(typeof m.size=="number"&&m.size>524288e3){alert(`文件过大: ${m.name} 超过500MB限制`);return}n(a.map(m=>({fileName:m.name,filePath:m.path||m.name}))),await d(a)}},[t,d]),{getRootProps:P,getInputProps:w,isDragActive:l}=L({onDrop:f,disabled:r||!t,multiple:!0});return v.useEffect(()=>{window.electronAPI?.onTransferProgress&&window.electronAPI.onTransferProgress(a=>{const m=I.getState().transferProgress;m&&c({...m,progress:typeof a.progress=="number"?a.progress:m.progress,speedMbps:typeof a.speedMbps=="number"?a.speedMbps:m.speedMbps,etaSeconds:typeof a.etaSeconds=="number"?a.etaSeconds:m.etaSeconds,targetPath:a.targetPath||m.targetPath,error:a.error||m.error})})},[c]),e.jsxs("div",{className:"min-w-[320px] w-full h-full min-h-0 bg-gradient-to-br from-blue-50 to-indigo-100 p-3 flex flex-col",children:[e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("div",{className:"flex justify-end items-center mb-3 electron-drag",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"electron-no-drag",children:e.jsx(U,{})}),e.jsx("div",{className:"electron-no-drag",children:e.jsx(q,{onSelect:a=>x(a)})}),e.jsx("button",{onClick:()=>g(!0),className:"p-2 rounded-lg shadow-md hover:shadow-lg transition-shadow electron-no-drag",title:"设置",children:e.jsx(O,{className:"w-5 h-5 text-gray-600"})})]})}),e.jsxs("div",{...P(),className:`
            electron-no-drag
            relative border-2 border-dashed rounded-2xl p-6 text-center transition-all duration-300
            ${l?"border-blue-600 bg-blue-80 scale-105":"border-gray-400 bg-white hover:border-gray-400"}
            ${!t||r?"opacity-50 cursor-not-allowed":"cursor-pointer"}
            min-w-[90px] flex-1 flex items-center justify-center
          `,children:[e.jsx("input",{...w()}),e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx(k,{className:`w-16 h-16 ${l?"text-blue-500":"text-gray-400"}`}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xl font-semibold text-gray-700",children:l?"释放文件以上传":"拖拽文件到此处"}),e.jsx("p",{className:"text-gray-500",children:t?r?"正在传输文件...":"或点击选择文件":"请先选择连接的设备"})]})]}),l&&e.jsx("div",{className:"absolute inset-0 bg蓝-100 bg-opacity-50 rounded-2xl"})]}),r&&e.jsx(v.Suspense,{fallback:e.jsx("div",{className:"p-2 text-gray-500",children:"加载进度..."}),children:e.jsx(Q,{})})]}),h&&e.jsx(v.Suspense,{fallback:e.jsx("div",{className:"p-4 text-gray-600",children:"加载设置..."}),children:e.jsx(W,{onClose:()=>g(!1)})})]})}const K=v.lazy(()=>E(()=>import("./HelpPage-CwgwbX6n.js"),__vite__mapDeps([3,1]),import.meta.url).then(t=>({default:t.HelpPage})));function Z(){const t=window.location.hash==="#/help"||new URLSearchParams(window.location.search).get("view")==="help";return e.jsx("div",{className:"h-full min-h-0 electron-drag flex flex-col",children:t?e.jsx(v.Suspense,{fallback:e.jsx("div",{className:"p-4 text-gray-600",children:"加载帮助..."}),children:e.jsx(K,{})}):e.jsx(J,{})})}class G extends v.Component{constructor(r){super(r),this.state={error:void 0}}static getDerivedStateFromError(r){return{error:r}}render(){if(this.state.error){const r=this.state.error?.message||"渲染错误",o=this.state.error?.stack||"";return e.jsxs("div",{style:{padding:16,fontFamily:"system-ui, sans-serif"},children:[e.jsx("h1",{style:{fontSize:18,marginBottom:8},children:"页面渲染失败"}),e.jsxs("div",{style:{color:"#b91c1c",marginBottom:8},children:["错误: ",r]}),e.jsx("pre",{style:{background:"#f9fafb",padding:12,borderRadius:8,overflow:"auto"},children:o})]})}return this.props.children}}F.createRoot(document.getElementById("root")).render(e.jsx(v.StrictMode,{children:e.jsx(G,{children:e.jsx(Z,{})})}));export{E as _,I as u};
